from io import StringIO, BytesIO

import requests
from flask import Flask, send_file, request, render_template

app = Flask(__name__, static_folder='assets', static_url_path='/assets', template_folder='assets')


# http://54.160.74.94/groups/2526736/YLIMtolShWf0hRuvVcP2HFYa
# https://www.zootle.me/
# https://gc3xbxz1tf.execute-api.us-east-1.amazonaws.com/prod/bib?groupID=2526736&privateKey=YLIMtolShWf0hRuvVcP2HFYa
@app.route('/')
def hello_world():
    return app.send_static_file('index.html')


def iterbuf(stri):
    while True:
        nl = stri.readline()
        if nl != '':
            yield nl.strip()
        else:
            raise StopIteration


def reverse_replace(bib, x, y):
    return bib.replace(y, x);


def special_char_handle(bib):
    bib = reverse_replace(bib, r"{\'{a}}", r"á")
    bib = reverse_replace(bib, r"{\'{c}}", r"ć")
    bib = reverse_replace(bib, r"{\'{e}}", r"é")
    bib = reverse_replace(bib, r"{\'{g}}", r"ǵ")
    bib = reverse_replace(bib, r"{\'{i}}", r"í")
    bib = reverse_replace(bib, r"{\'{n}}", r"ń")
    bib = reverse_replace(bib, r"{\'{o}}", r"ó")
    bib = reverse_replace(bib, r"{\'{r}}", r"ŕ")
    bib = reverse_replace(bib, r"{\'{s}}", r"ś")
    bib = reverse_replace(bib, r"{\'{u}}", r"ú")
    bib = reverse_replace(bib, r"{\'{w}}", r"ẃ")
    bib = reverse_replace(bib, r"{\'{y}}", r"ý")
    bib = reverse_replace(bib, r"{\'{z}}", r"ź")
    bib = reverse_replace(bib, r"{\'{\a}}", r"á")
    bib = reverse_replace(bib, r"{\'{\c}}", r"ć")
    bib = reverse_replace(bib, r"{\'{\e}}", r"é")
    bib = reverse_replace(bib, r"{\'{\g}}", r"ǵ")
    bib = reverse_replace(bib, r"{\'{\i}}", r"í")
    bib = reverse_replace(bib, r"{\'{\n}}", r"ń")
    bib = reverse_replace(bib, r"{\'{\o}}", r"ó")
    bib = reverse_replace(bib, r"{\'{\r}}", r"ŕ")
    bib = reverse_replace(bib, r"{\'{\s}}", r"ś")
    bib = reverse_replace(bib, r"{\'{\u}}", r"ú")
    bib = reverse_replace(bib, r"{\'{\w}}", r"ẃ")
    bib = reverse_replace(bib, r"{\'{\y}}", r"ý")
    bib = reverse_replace(bib, r"{\'{\z}}", r"ź")
    bib = reverse_replace(bib, r"{\' a}", r"á")
    bib = reverse_replace(bib, r"{\' c}", r"ć")
    bib = reverse_replace(bib, r"{\' e}", r"é")
    bib = reverse_replace(bib, r"{\' g}", r"ǵ")
    bib = reverse_replace(bib, r"{\' i}", r"í")
    bib = reverse_replace(bib, r"{\' n}", r"ń")
    bib = reverse_replace(bib, r"{\' o}", r"ó")
    bib = reverse_replace(bib, r"{\' r}", r"ŕ")
    bib = reverse_replace(bib, r"{\' s}", r"ś")
    bib = reverse_replace(bib, r"{\' u}", r"ú")
    bib = reverse_replace(bib, r"{\' w}", r"ẃ")
    bib = reverse_replace(bib, r"{\' y}", r"ý")
    bib = reverse_replace(bib, r"{\' z}", r"ź")
    bib = reverse_replace(bib, r"{\'a}", r"á")
    bib = reverse_replace(bib, r"{\'c}", r"ć")
    bib = reverse_replace(bib, r"{\'e}", r"é")
    bib = reverse_replace(bib, r"{\'g}", r"ǵ")
    bib = reverse_replace(bib, r"{\'i}", r"í")
    bib = reverse_replace(bib, r"{\'n}", r"ń")
    bib = reverse_replace(bib, r"{\'o}", r"ó")
    bib = reverse_replace(bib, r"{\'r}", r"ŕ")
    bib = reverse_replace(bib, r"{\'s}", r"ś")
    bib = reverse_replace(bib, r"{\'u}", r"ú")
    bib = reverse_replace(bib, r"{\'w}", r"ẃ")
    bib = reverse_replace(bib, r"{\'y}", r"ý")
    bib = reverse_replace(bib, r"{\'z}", r"ź")
    bib = reverse_replace(bib, r"{\'{A}}", r"Á")
    bib = reverse_replace(bib, r"{\'{C}}", r"Ć")
    bib = reverse_replace(bib, r"{\'{E}}", r"É")
    bib = reverse_replace(bib, r"{\'{G}}", r"Ǵ")
    bib = reverse_replace(bib, r"{\'{I}}", r"Í")
    bib = reverse_replace(bib, r"{\'{N}}", r"Ń")
    bib = reverse_replace(bib, r"{\'{O}}", r"Ó")
    bib = reverse_replace(bib, r"{\'{R}}", r"Ŕ")
    bib = reverse_replace(bib, r"{\'{S}}", r"Ś")
    bib = reverse_replace(bib, r"{\'{U}}", r"Ú")
    bib = reverse_replace(bib, r"{\'{W}}", r"Ẃ")
    bib = reverse_replace(bib, r"{\'{Y}}", r"Ý")
    bib = reverse_replace(bib, r"{\'{Z}}", r"Ź")
    bib = reverse_replace(bib, r"{\'{\a}}", r"Á")
    bib = reverse_replace(bib, r"{\'{\c}}", r"Ć")
    bib = reverse_replace(bib, r"{\'{\e}}", r"É")
    bib = reverse_replace(bib, r"{\'{\G}}", r"Ǵ")
    bib = reverse_replace(bib, r"{\'{\I}}", r"Í")
    bib = reverse_replace(bib, r"{\'{\n}}", r"Ń")
    bib = reverse_replace(bib, r"{\'{\O}}", r"Ó")
    bib = reverse_replace(bib, r"{\'{\r}}", r"Ŕ")
    bib = reverse_replace(bib, r"{\'{\S}}", r"Ś")
    bib = reverse_replace(bib, r"{\'{\U}}", r"Ú")
    bib = reverse_replace(bib, r"{\'{\W}}", r"Ẃ")
    bib = reverse_replace(bib, r"{\'{\Y}}", r"Ý")
    bib = reverse_replace(bib, r"{\'{\Z}}", r"Ź")
    bib = reverse_replace(bib, r"{\' A}", r"Á")
    bib = reverse_replace(bib, r"{\' C}", r"Ć")
    bib = reverse_replace(bib, r"{\' E}", r"É")
    bib = reverse_replace(bib, r"{\' G}", r"Ǵ")
    bib = reverse_replace(bib, r"{\' I}", r"Í")
    bib = reverse_replace(bib, r"{\' N}", r"Ń")
    bib = reverse_replace(bib, r"{\' O}", r"Ó")
    bib = reverse_replace(bib, r"{\' R}", r"Ŕ")
    bib = reverse_replace(bib, r"{\' S}", r"Ś")
    bib = reverse_replace(bib, r"{\' U}", r"Ú")
    bib = reverse_replace(bib, r"{\' W}", r"Ẃ")
    bib = reverse_replace(bib, r"{\' Y}", r"Ý")
    bib = reverse_replace(bib, r"{\' Z}", r"Ź")
    bib = reverse_replace(bib, r"{\'A}", r"Á")
    bib = reverse_replace(bib, r"{\'C}", r"Ć")
    bib = reverse_replace(bib, r"{\'E}", r"É")
    bib = reverse_replace(bib, r"{\'G}", r"Ǵ")
    bib = reverse_replace(bib, r"{\'I}", r"Í")
    bib = reverse_replace(bib, r"{\'N}", r"Ń")
    bib = reverse_replace(bib, r"{\'O}", r"Ó")
    bib = reverse_replace(bib, r"{\'R}", r"Ŕ")
    bib = reverse_replace(bib, r"{\'S}", r"Ś")
    bib = reverse_replace(bib, r"{\'U}", r"Ú")
    bib = reverse_replace(bib, r"{\'W}", r"Ẃ")
    bib = reverse_replace(bib, r"{\'Y}", r"Ý")
    bib = reverse_replace(bib, r"{\'Z}", r"Ź")
    bib = reverse_replace(bib, r"\'{a}", r"á")
    bib = reverse_replace(bib, r"\'{c}", r"ć")
    bib = reverse_replace(bib, r"\'{e}", r"é")
    bib = reverse_replace(bib, r"\'{g}", r"ǵ")
    bib = reverse_replace(bib, r"\'{i}", r"í")
    bib = reverse_replace(bib, r"\'{n}", r"ń")
    bib = reverse_replace(bib, r"\'{o}", r"ó")
    bib = reverse_replace(bib, r"\'{r}", r"ŕ")
    bib = reverse_replace(bib, r"\'{s}", r"ś")
    bib = reverse_replace(bib, r"\'{u}", r"ú")
    bib = reverse_replace(bib, r"\'{w}", r"ẃ")
    bib = reverse_replace(bib, r"\'{y}", r"ý")
    bib = reverse_replace(bib, r"\'{z}", r"ź")
    bib = reverse_replace(bib, r"\'a", r"á")
    bib = reverse_replace(bib, r"\'c", r"ć")
    bib = reverse_replace(bib, r"\'e", r"é")
    bib = reverse_replace(bib, r"\'g", r"ǵ")
    bib = reverse_replace(bib, r"\'i", r"í")
    bib = reverse_replace(bib, r"\'n", r"ń")
    bib = reverse_replace(bib, r"\'o", r"ó")
    bib = reverse_replace(bib, r"\'r", r"ŕ")
    bib = reverse_replace(bib, r"\'s", r"ś")
    bib = reverse_replace(bib, r"\'u", r"ú")
    bib = reverse_replace(bib, r"\'w", r"ẃ")
    bib = reverse_replace(bib, r"\'y", r"ý")
    bib = reverse_replace(bib, r"\'z", r"ź")
    bib = reverse_replace(bib, r"\'{\a}", r"á")
    bib = reverse_replace(bib, r"\'{\c}", r"ć")
    bib = reverse_replace(bib, r"\'{\e}", r"é")
    bib = reverse_replace(bib, r"\'{\g}", r"ǵ")
    bib = reverse_replace(bib, r"\'{\i}", r"í")
    bib = reverse_replace(bib, r"\'{\n}", r"ń")
    bib = reverse_replace(bib, r"\'{\o}", r"ó")
    bib = reverse_replace(bib, r"\'{\r}", r"ŕ")
    bib = reverse_replace(bib, r"\'{\s}", r"ś")
    bib = reverse_replace(bib, r"\'{\u}", r"ú")
    bib = reverse_replace(bib, r"\'{\w}", r"ẃ")
    bib = reverse_replace(bib, r"\'{\y}", r"ý")
    bib = reverse_replace(bib, r"\'{\z}", r"ź")
    bib = reverse_replace(bib, r"\'{A}", r"Á")
    bib = reverse_replace(bib, r"\'{C}", r"Ć")
    bib = reverse_replace(bib, r"\'{E}", r"É")
    bib = reverse_replace(bib, r"\'{G}", r"Ǵ")
    bib = reverse_replace(bib, r"\'{I}", r"Í")
    bib = reverse_replace(bib, r"\'{N}", r"Ń")
    bib = reverse_replace(bib, r"\'{O}", r"Ó")
    bib = reverse_replace(bib, r"\'{R}", r"Ŕ")
    bib = reverse_replace(bib, r"\'{S}", r"Ś")
    bib = reverse_replace(bib, r"\'{U}", r"Ú")
    bib = reverse_replace(bib, r"\'{W}", r"Ẃ")
    bib = reverse_replace(bib, r"\'{Y}", r"Ý")
    bib = reverse_replace(bib, r"\'{Z}", r"Ź")
    bib = reverse_replace(bib, r"\'A", r"Á")
    bib = reverse_replace(bib, r"\'C", r"Ć")
    bib = reverse_replace(bib, r"\'E", r"É")
    bib = reverse_replace(bib, r"\'G", r"Ǵ")
    bib = reverse_replace(bib, r"\'I", r"Í")
    bib = reverse_replace(bib, r"\'N", r"Ń")
    bib = reverse_replace(bib, r"\'O", r"Ó")
    bib = reverse_replace(bib, r"\'R", r"Ŕ")
    bib = reverse_replace(bib, r"\'S", r"Ś")
    bib = reverse_replace(bib, r"\'U", r"Ú")
    bib = reverse_replace(bib, r"\'W", r"Ẃ")
    bib = reverse_replace(bib, r"\'Y", r"Ý")
    bib = reverse_replace(bib, r"\'Z", r"Ź")
    bib = reverse_replace(bib, r"\'{\a}", r"Á")
    bib = reverse_replace(bib, r"\'{\c}", r"Ć")
    bib = reverse_replace(bib, r"\'{\e}", r"É")
    bib = reverse_replace(bib, r"\'{\G}", r"Ǵ")
    bib = reverse_replace(bib, r"\'{\I}", r"Í")
    bib = reverse_replace(bib, r"\'{\n}", r"Ń")
    bib = reverse_replace(bib, r"\'{\O}", r"Ó")
    bib = reverse_replace(bib, r"\'{\r}", r"Ŕ")
    bib = reverse_replace(bib, r"\'{\S}", r"Ś")
    bib = reverse_replace(bib, r"\'{\U}", r"Ú")
    bib = reverse_replace(bib, r"\'{\W}", r"Ẃ")
    bib = reverse_replace(bib, r"\'{\Y}", r"Ý")
    bib = reverse_replace(bib, r"\'{\Z}", r"Ź")
    bib = reverse_replace(bib, r'{\`{a}}', r"à")
    bib = reverse_replace(bib, r'{\`{e}}', r"è")
    bib = reverse_replace(bib, r'{\`{i}}', r"ì")
    bib = reverse_replace(bib, r'{\`{o}}', r"ò")
    bib = reverse_replace(bib, r'{\`{u}}', r"ù")
    bib = reverse_replace(bib, r'{\`{\a}}', r"à")
    bib = reverse_replace(bib, r'{\`{\e}}', r"è")
    bib = reverse_replace(bib, r'{\`{\i}}', r"ì")
    bib = reverse_replace(bib, r'{\`{\o}}', r"ò")
    bib = reverse_replace(bib, r'{\`{\u}}', r"ù")
    bib = reverse_replace(bib, r'{\` a}', r"à")
    bib = reverse_replace(bib, r'{\` e}', r"è")
    bib = reverse_replace(bib, r'{\` i}', r"ì")
    bib = reverse_replace(bib, r'{\` o}', r"ò")
    bib = reverse_replace(bib, r'{\` u}', r"ù")
    bib = reverse_replace(bib, r'{\`a}', r"à")
    bib = reverse_replace(bib, r'{\`e}', r"è")
    bib = reverse_replace(bib, r'{\`i}', r"ì")
    bib = reverse_replace(bib, r'{\`o}', r"ò")
    bib = reverse_replace(bib, r'{\`u}', r"ù")
    bib = reverse_replace(bib, r'{\`{A}}', r"À")
    bib = reverse_replace(bib, r'{\`{E}}', r"È")
    bib = reverse_replace(bib, r'{\`{I}}', r"Ì")
    bib = reverse_replace(bib, r'{\`{O}}', r"Ò")
    bib = reverse_replace(bib, r'{\`{U}}', r"Ù")
    bib = reverse_replace(bib, r'{\`{\a}}', r"À")
    bib = reverse_replace(bib, r'{\`{\e}}', r"È")
    bib = reverse_replace(bib, r'{\`{\I}}', r"Ì")
    bib = reverse_replace(bib, r'{\`{\O}}', r"Ò")
    bib = reverse_replace(bib, r'{\`{\U}}', r"Ù")
    bib = reverse_replace(bib, r'{\` A}', r"À")
    bib = reverse_replace(bib, r'{\` E}', r"È")
    bib = reverse_replace(bib, r'{\` I}', r"Ì")
    bib = reverse_replace(bib, r'{\` O}', r"Ò")
    bib = reverse_replace(bib, r'{\` U}', r"Ù")
    bib = reverse_replace(bib, r'{\`A}', r"À")
    bib = reverse_replace(bib, r'{\`E}', r"È")
    bib = reverse_replace(bib, r'{\`I}', r"Ì")
    bib = reverse_replace(bib, r'{\`O}', r"Ò")
    bib = reverse_replace(bib, r'{\`U}', r"Ù")
    bib = reverse_replace(bib, r'\`{a}', r"à")
    bib = reverse_replace(bib, r'\`{e}', r"è")
    bib = reverse_replace(bib, r'\`{i}', r"ì")
    bib = reverse_replace(bib, r'\`{o}', r"ò")
    bib = reverse_replace(bib, r'\`{u}', r"ù")
    bib = reverse_replace(bib, r'\`a', r"à")
    bib = reverse_replace(bib, r'\`e', r"è")
    bib = reverse_replace(bib, r'\`i', r"ì")
    bib = reverse_replace(bib, r'\`o', r"ò")
    bib = reverse_replace(bib, r'\`u', r"ù")
    bib = reverse_replace(bib, r'\`{\a}', r"à")
    bib = reverse_replace(bib, r'\`{\e}', r"è")
    bib = reverse_replace(bib, r'\`{\i}', r"ì")
    bib = reverse_replace(bib, r'\`{\o}', r"ò")
    bib = reverse_replace(bib, r'\`{\u}', r"ù")
    bib = reverse_replace(bib, r'\`{A}', r"À")
    bib = reverse_replace(bib, r'\`{E}', r"È")
    bib = reverse_replace(bib, r'\`{I}', r"Ì")
    bib = reverse_replace(bib, r'\`{O}', r"Ò")
    bib = reverse_replace(bib, r'\`{U}', r"Ù")
    bib = reverse_replace(bib, r'\`A', r"À")
    bib = reverse_replace(bib, r'\`E', r"È")
    bib = reverse_replace(bib, r'\`I', r"Ì")
    bib = reverse_replace(bib, r'\`O', r"Ò")
    bib = reverse_replace(bib, r'\`U', r"Ù")
    bib = reverse_replace(bib, r'\`{\a}', r"À")
    bib = reverse_replace(bib, r'\`{\e}', r"È")
    bib = reverse_replace(bib, r'\`{\I}', r"Ì")
    bib = reverse_replace(bib, r'\`{\O}', r"Ò")
    bib = reverse_replace(bib, r'\`{\U}', r"Ù")
    bib = reverse_replace(bib, r'{\^{a}}', r"â")
    bib = reverse_replace(bib, r'{\^{c}}', r"ĉ")
    bib = reverse_replace(bib, r'{\^{e}}', r"ê")
    bib = reverse_replace(bib, r'{\^{g}}', r"ĝ")
    bib = reverse_replace(bib, r'{\^{i}}', r"î")
    bib = reverse_replace(bib, r'{\^{j}}', r"ĵ")
    bib = reverse_replace(bib, r'{\^{o}}', r"ô")
    bib = reverse_replace(bib, r'{\^{s}}', r"ŝ")
    bib = reverse_replace(bib, r'{\^{u}}', r"û")
    bib = reverse_replace(bib, r'{\^{\a}}', r"â")
    bib = reverse_replace(bib, r'{\^{\c}}', r"ĉ")
    bib = reverse_replace(bib, r'{\^{\e}}', r"ê")
    bib = reverse_replace(bib, r'{\^{\g}}', r"ĝ")
    bib = reverse_replace(bib, r'{\^{\i}}', r"î")
    bib = reverse_replace(bib, r'{\^{\j}}', r"ĵ")
    bib = reverse_replace(bib, r'{\^{\o}}', r"ô")
    bib = reverse_replace(bib, r'{\^{\s}}', r"ŝ")
    bib = reverse_replace(bib, r'{\^{\u}}', r"û")
    bib = reverse_replace(bib, r'{\^ a}', r"â")
    bib = reverse_replace(bib, r'{\^ c}', r"ĉ")
    bib = reverse_replace(bib, r'{\^ e}', r"ê")
    bib = reverse_replace(bib, r'{\^ g}', r"ĝ")
    bib = reverse_replace(bib, r'{\^ i}', r"î")
    bib = reverse_replace(bib, r'{\^ j}', r"ĵ")
    bib = reverse_replace(bib, r'{\^ o}', r"ô")
    bib = reverse_replace(bib, r'{\^ s}', r"ŝ")
    bib = reverse_replace(bib, r'{\^ u}', r"û")
    bib = reverse_replace(bib, r'{\^a}', r"â")
    bib = reverse_replace(bib, r'{\^c}', r"ĉ")
    bib = reverse_replace(bib, r'{\^e}', r"ê")
    bib = reverse_replace(bib, r'{\^g}', r"ĝ")
    bib = reverse_replace(bib, r'{\^i}', r"î")
    bib = reverse_replace(bib, r'{\^j}', r"ĵ")
    bib = reverse_replace(bib, r'{\^o}', r"ô")
    bib = reverse_replace(bib, r'{\^s}', r"ŝ")
    bib = reverse_replace(bib, r'{\^u}', r"û")
    bib = reverse_replace(bib, r'{\^{A}}', r"Â")
    bib = reverse_replace(bib, r'{\^{C}}', r"Ĉ")
    bib = reverse_replace(bib, r'{\^{E}}', r"Ê")
    bib = reverse_replace(bib, r'{\^{G}}', r"Ĝ")
    bib = reverse_replace(bib, r'{\^{I}}', r"Î")
    bib = reverse_replace(bib, r'{\^{J}}', r"Ĵ")
    bib = reverse_replace(bib, r'{\^{O}}', r"Ô")
    bib = reverse_replace(bib, r'{\^{S}}', r"Ŝ")
    bib = reverse_replace(bib, r'{\^{U}}', r"Û")
    bib = reverse_replace(bib, r'{\^{\a}}', r"Â")
    bib = reverse_replace(bib, r'{\^{\c}}', r"Ĉ")
    bib = reverse_replace(bib, r'{\^{\e}}', r"Ê")
    bib = reverse_replace(bib, r'{\^{\G}}', r"Ĝ")
    bib = reverse_replace(bib, r'{\^{\I}}', r"Î")
    bib = reverse_replace(bib, r'{\^{\J}}', r"Ĵ")
    bib = reverse_replace(bib, r'{\^{\O}}', r"Ô")
    bib = reverse_replace(bib, r'{\^{\S}}', r"Ŝ")
    bib = reverse_replace(bib, r'{\^{\U}}', r"Û")
    bib = reverse_replace(bib, r'{\^ A}', r"Â")
    bib = reverse_replace(bib, r'{\^ C}', r"Ĉ")
    bib = reverse_replace(bib, r'{\^ E}', r"Ê")
    bib = reverse_replace(bib, r'{\^ G}', r"Ĝ")
    bib = reverse_replace(bib, r'{\^ I}', r"Î")
    bib = reverse_replace(bib, r'{\^ J}', r"Ĵ")
    bib = reverse_replace(bib, r'{\^ O}', r"Ô")
    bib = reverse_replace(bib, r'{\^ S}', r"Ŝ")
    bib = reverse_replace(bib, r'{\^ U}', r"Û")
    bib = reverse_replace(bib, r'{\^A}', r"Â")
    bib = reverse_replace(bib, r'{\^C}', r"Ĉ")
    bib = reverse_replace(bib, r'{\^E}', r"Ê")
    bib = reverse_replace(bib, r'{\^G}', r"Ĝ")
    bib = reverse_replace(bib, r'{\^I}', r"Î")
    bib = reverse_replace(bib, r'{\^J}', r"Ĵ")
    bib = reverse_replace(bib, r'{\^O}', r"Ô")
    bib = reverse_replace(bib, r'{\^S}', r"Ŝ")
    bib = reverse_replace(bib, r'{\^U}', r"Û")
    bib = reverse_replace(bib, r'\^{a}', r"â")
    bib = reverse_replace(bib, r'\^{c}', r"ĉ")
    bib = reverse_replace(bib, r'\^{e}', r"ê")
    bib = reverse_replace(bib, r'\^{g}', r"ĝ")
    bib = reverse_replace(bib, r'\^{i}', r"î")
    bib = reverse_replace(bib, r'\^{j}', r"ĵ")
    bib = reverse_replace(bib, r'\^{o}', r"ô")
    bib = reverse_replace(bib, r'\^{s}', r"ŝ")
    bib = reverse_replace(bib, r'\^{u}', r"û")
    bib = reverse_replace(bib, r'\^a', r"â")
    bib = reverse_replace(bib, r'\^c', r"ĉ")
    bib = reverse_replace(bib, r'\^e', r"ê")
    bib = reverse_replace(bib, r'\^g', r"ĝ")
    bib = reverse_replace(bib, r'\^i', r"î")
    bib = reverse_replace(bib, r'\^j', r"ĵ")
    bib = reverse_replace(bib, r'\^o', r"ô")
    bib = reverse_replace(bib, r'\^s', r"ŝ")
    bib = reverse_replace(bib, r'\^u', r"û")
    bib = reverse_replace(bib, r'\^{\a}', r"â")
    bib = reverse_replace(bib, r'\^{\c}', r"ĉ")
    bib = reverse_replace(bib, r'\^{\e}', r"ê")
    bib = reverse_replace(bib, r'\^{\g}', r"ĝ")
    bib = reverse_replace(bib, r'\^{\i}', r"î")
    bib = reverse_replace(bib, r'\^{\j}', r"ĵ")
    bib = reverse_replace(bib, r'\^{\o}', r"ô")
    bib = reverse_replace(bib, r'\^{\s}', r"ŝ")
    bib = reverse_replace(bib, r'\^{\u}', r"û")
    bib = reverse_replace(bib, r'\^{A}', r"Â")
    bib = reverse_replace(bib, r'\^{C}', r"Ĉ")
    bib = reverse_replace(bib, r'\^{E}', r"Ê")
    bib = reverse_replace(bib, r'\^{G}', r"Ĝ")
    bib = reverse_replace(bib, r'\^{I}', r"Î")
    bib = reverse_replace(bib, r'\^{J}', r"Ĵ")
    bib = reverse_replace(bib, r'\^{O}', r"Ô")
    bib = reverse_replace(bib, r'\^{S}', r"Ŝ")
    bib = reverse_replace(bib, r'\^{U}', r"Û")
    bib = reverse_replace(bib, r'\^A', r"Â")
    bib = reverse_replace(bib, r'\^C', r"Ĉ")
    bib = reverse_replace(bib, r'\^E', r"Ê")
    bib = reverse_replace(bib, r'\^G', r"Ĝ")
    bib = reverse_replace(bib, r'\^I', r"Î")
    bib = reverse_replace(bib, r'\^J', r"Ĵ")
    bib = reverse_replace(bib, r'\^O', r"Ô")
    bib = reverse_replace(bib, r'\^S', r"Ŝ")
    bib = reverse_replace(bib, r'\^U', r"Û")
    bib = reverse_replace(bib, r'\^{\a}', r"Â")
    bib = reverse_replace(bib, r'\^{\c}', r"Ĉ")
    bib = reverse_replace(bib, r'\^{\e}', r"Ê")
    bib = reverse_replace(bib, r'\^{\G}', r"Ĝ")
    bib = reverse_replace(bib, r'\^{\I}', r"Î")
    bib = reverse_replace(bib, r'\^{\J}', r"Ĵ")
    bib = reverse_replace(bib, r'\^{\O}', r"Ô")
    bib = reverse_replace(bib, r'\^{\S}', r"Ŝ")
    bib = reverse_replace(bib, r'\^{\U}', r"Û")
    bib = reverse_replace(bib, r'{\"{a}}', r"ä")
    bib = reverse_replace(bib, r'{\"{e}}', r"ë")
    bib = reverse_replace(bib, r'{\"{i}}', r"ï")
    bib = reverse_replace(bib, r'{\"{o}}', r"ö")
    bib = reverse_replace(bib, r'{\"{u}}', r"ü")
    bib = reverse_replace(bib, r'{\"{\a}}', r"ä")
    bib = reverse_replace(bib, r'{\"{\e}}', r"ë")
    bib = reverse_replace(bib, r'{\"{\i}}', r"ï")
    bib = reverse_replace(bib, r'{\"{\o}}', r"ö")
    bib = reverse_replace(bib, r'{\"{\u}}', r"ü")
    bib = reverse_replace(bib, r'{\" a}', r"ä")
    bib = reverse_replace(bib, r'{\" e}', r"ë")
    bib = reverse_replace(bib, r'{\" i}', r"ï")
    bib = reverse_replace(bib, r'{\" o}', r"ö")
    bib = reverse_replace(bib, r'{\" u}', r"ü")
    bib = reverse_replace(bib, r'{\"a}', r"ä")
    bib = reverse_replace(bib, r'{\"e}', r"ë")
    bib = reverse_replace(bib, r'{\"i}', r"ï")
    bib = reverse_replace(bib, r'{\"o}', r"ö")
    bib = reverse_replace(bib, r'{\"u}', r"ü")
    bib = reverse_replace(bib, r'{\"{A}}', r"Ä")
    bib = reverse_replace(bib, r'{\"{E}}', r"Ë")
    bib = reverse_replace(bib, r'{\"{I}}', r"Ï")
    bib = reverse_replace(bib, r'{\"{O}}', r"Ö")
    bib = reverse_replace(bib, r'{\"{U}}', r"Ü")
    bib = reverse_replace(bib, r'{\"{\a}}', r"Ä")
    bib = reverse_replace(bib, r'{\"{\e}}', r"Ë")
    bib = reverse_replace(bib, r'{\"{\I}}', r"Ï")
    bib = reverse_replace(bib, r'{\"{\O}}', r"Ö")
    bib = reverse_replace(bib, r'{\"{\U}}', r"Ü")
    bib = reverse_replace(bib, r'{\" A}', r"Ä")
    bib = reverse_replace(bib, r'{\" E}', r"Ë")
    bib = reverse_replace(bib, r'{\" I}', r"Ï")
    bib = reverse_replace(bib, r'{\" O}', r"Ö")
    bib = reverse_replace(bib, r'{\" U}', r"Ü")
    bib = reverse_replace(bib, r'{\"A}', r"Ä")
    bib = reverse_replace(bib, r'{\"E}', r"Ë")
    bib = reverse_replace(bib, r'{\"I}', r"Ï")
    bib = reverse_replace(bib, r'{\"O}', r"Ö")
    bib = reverse_replace(bib, r'{\"U}', r"Ü")
    bib = reverse_replace(bib, r'\"{a}', r"ä")
    bib = reverse_replace(bib, r'\"{e}', r"ë")
    bib = reverse_replace(bib, r'\"{i}', r"ï")
    bib = reverse_replace(bib, r'\"{o}', r"ö")
    bib = reverse_replace(bib, r'\"{u}', r"ü")
    bib = reverse_replace(bib, r'\"a', r"ä")
    bib = reverse_replace(bib, r'\"e', r"ë")
    bib = reverse_replace(bib, r'\"i', r"ï")
    bib = reverse_replace(bib, r'\"o', r"ö")
    bib = reverse_replace(bib, r'\"u', r"ü")
    bib = reverse_replace(bib, r'\"{\a}', r"ä")
    bib = reverse_replace(bib, r'\"{\e}', r"ë")
    bib = reverse_replace(bib, r'\"{\i}', r"ï")
    bib = reverse_replace(bib, r'\"{\o}', r"ö")
    bib = reverse_replace(bib, r'\"{\u}', r"ü")
    bib = reverse_replace(bib, r'\"{A}', r"Ä")
    bib = reverse_replace(bib, r'\"{E}', r"Ë")
    bib = reverse_replace(bib, r'\"{I}', r"Ï")
    bib = reverse_replace(bib, r'\"{O}', r"Ö")
    bib = reverse_replace(bib, r'\"{U}', r"Ü")
    bib = reverse_replace(bib, r'\"A', r"Ä")
    bib = reverse_replace(bib, r'\"E', r"Ë")
    bib = reverse_replace(bib, r'\"I', r"Ï")
    bib = reverse_replace(bib, r'\"O', r"Ö")
    bib = reverse_replace(bib, r'\"U', r"Ü")
    bib = reverse_replace(bib, r'\"{\a}', r"Ä")
    bib = reverse_replace(bib, r'\"{\e}', r"Ë")
    bib = reverse_replace(bib, r'\"{\I}', r"Ï")
    bib = reverse_replace(bib, r'\"{\O}', r"Ö")
    bib = reverse_replace(bib, r'\"{\U}', r"Ü")
    bib = reverse_replace(bib, r'{\={a}}', r"ā")
    bib = reverse_replace(bib, r'{\={e}}', r"ē")
    bib = reverse_replace(bib, r'{\={i}}', r"ī")
    bib = reverse_replace(bib, r'{\={o}}', r"ō")
    bib = reverse_replace(bib, r'{\={u}}', r"ū")
    bib = reverse_replace(bib, r'{\={\a}}', r"ā")
    bib = reverse_replace(bib, r'{\={\e}}', r"ē")
    bib = reverse_replace(bib, r'{\={\i}}', r"ī")
    bib = reverse_replace(bib, r'{\={\o}}', r"ō")
    bib = reverse_replace(bib, r'{\={\u}}', r"ū")
    bib = reverse_replace(bib, r'{\= a}', r"ā")
    bib = reverse_replace(bib, r'{\= e}', r"ē")
    bib = reverse_replace(bib, r'{\= i}', r"ī")
    bib = reverse_replace(bib, r'{\= o}', r"ō")
    bib = reverse_replace(bib, r'{\= u}', r"ū")
    bib = reverse_replace(bib, r'{\=a}', r"ā")
    bib = reverse_replace(bib, r'{\=e}', r"ē")
    bib = reverse_replace(bib, r'{\=i}', r"ī")
    bib = reverse_replace(bib, r'{\=o}', r"ō")
    bib = reverse_replace(bib, r'{\=u}', r"ū")
    bib = reverse_replace(bib, r'{\={A}}', r"Ā")
    bib = reverse_replace(bib, r'{\={E}}', r"Ē")
    bib = reverse_replace(bib, r'{\={I}}', r"Ī")
    bib = reverse_replace(bib, r'{\={O}}', r"Ō")
    bib = reverse_replace(bib, r'{\={U}}', r"Ū")
    bib = reverse_replace(bib, r'{\={\a}}', r"Ā")
    bib = reverse_replace(bib, r'{\={\e}}', r"Ē")
    bib = reverse_replace(bib, r'{\={\I}}', r"Ī")
    bib = reverse_replace(bib, r'{\={\O}}', r"Ō")
    bib = reverse_replace(bib, r'{\={\U}}', r"Ū")
    bib = reverse_replace(bib, r'{\= A}', r"Ā")
    bib = reverse_replace(bib, r'{\= E}', r"Ē")
    bib = reverse_replace(bib, r'{\= I}', r"Ī")
    bib = reverse_replace(bib, r'{\= O}', r"Ō")
    bib = reverse_replace(bib, r'{\= U}', r"Ū")
    bib = reverse_replace(bib, r'{\=A}', r"Ā")
    bib = reverse_replace(bib, r'{\=E}', r"Ē")
    bib = reverse_replace(bib, r'{\=I}', r"Ī")
    bib = reverse_replace(bib, r'{\=O}', r"Ō")
    bib = reverse_replace(bib, r'{\=U}', r"Ū")
    bib = reverse_replace(bib, r'\={a}', r"ā")
    bib = reverse_replace(bib, r'\={e}', r"ē")
    bib = reverse_replace(bib, r'\={i}', r"ī")
    bib = reverse_replace(bib, r'\={o}', r"ō")
    bib = reverse_replace(bib, r'\={u}', r"ū")
    bib = reverse_replace(bib, r'\=a', r"ā")
    bib = reverse_replace(bib, r'\=e', r"ē")
    bib = reverse_replace(bib, r'\=i', r"ī")
    bib = reverse_replace(bib, r'\=o', r"ō")
    bib = reverse_replace(bib, r'\=u', r"ū")
    bib = reverse_replace(bib, r'\={\a}', r"ā")
    bib = reverse_replace(bib, r'\={\e}', r"ē")
    bib = reverse_replace(bib, r'\={\i}', r"ī")
    bib = reverse_replace(bib, r'\={\o}', r"ō")
    bib = reverse_replace(bib, r'\={\u}', r"ū")
    bib = reverse_replace(bib, r'\={A}', r"Ā")
    bib = reverse_replace(bib, r'\={E}', r"Ē")
    bib = reverse_replace(bib, r'\={I}', r"Ī")
    bib = reverse_replace(bib, r'\={O}', r"Ō")
    bib = reverse_replace(bib, r'\={U}', r"Ū")
    bib = reverse_replace(bib, r'\=A', r"Ā")
    bib = reverse_replace(bib, r'\=E', r"Ē")
    bib = reverse_replace(bib, r'\=I', r"Ī")
    bib = reverse_replace(bib, r'\=O', r"Ō")
    bib = reverse_replace(bib, r'\=U', r"Ū")
    bib = reverse_replace(bib, r'\={\a}', r"Ā")
    bib = reverse_replace(bib, r'\={\e}', r"Ē")
    bib = reverse_replace(bib, r'\={\I}', r"Ī")
    bib = reverse_replace(bib, r'\={\O}', r"Ō")
    bib = reverse_replace(bib, r'\={\U}', r"Ū")
    bib = reverse_replace(bib, r'{\.{a}}', r"ȧ")
    bib = reverse_replace(bib, r'{\.{c}}', r"ċ")
    bib = reverse_replace(bib, r'{\.{e}}', r"ė")
    bib = reverse_replace(bib, r'{\.{g}}', r"ġ")
    bib = reverse_replace(bib, r'{\.{o}}', r"ȯ")
    bib = reverse_replace(bib, r'{\.{z}}', r"ż")
    bib = reverse_replace(bib, r'{\.{\a}}', r"ȧ")
    bib = reverse_replace(bib, r'{\.{\c}}', r"ċ")
    bib = reverse_replace(bib, r'{\.{\e}}', r"ė")
    bib = reverse_replace(bib, r'{\.{\g}}', r"ġ")
    bib = reverse_replace(bib, r'{\.{\o}}', r"ȯ")
    bib = reverse_replace(bib, r'{\.{\z}}', r"ż")
    bib = reverse_replace(bib, r'{\. a}', r"ȧ")
    bib = reverse_replace(bib, r'{\. c}', r"ċ")
    bib = reverse_replace(bib, r'{\. e}', r"ė")
    bib = reverse_replace(bib, r'{\. g}', r"ġ")
    bib = reverse_replace(bib, r'{\. o}', r"ȯ")
    bib = reverse_replace(bib, r'{\. z}', r"ż")
    bib = reverse_replace(bib, r'{\.a}', r"ȧ")
    bib = reverse_replace(bib, r'{\.c}', r"ċ")
    bib = reverse_replace(bib, r'{\.e}', r"ė")
    bib = reverse_replace(bib, r'{\.g}', r"ġ")
    bib = reverse_replace(bib, r'{\.o}', r"ȯ")
    bib = reverse_replace(bib, r'{\.z}', r"ż")
    bib = reverse_replace(bib, r'{\.{A}}', r"Ȧ")
    bib = reverse_replace(bib, r'{\.{C}}', r"Ċ")
    bib = reverse_replace(bib, r'{\.{E}}', r"Ė")
    bib = reverse_replace(bib, r'{\.{G}}', r"Ġ")
    bib = reverse_replace(bib, r'{\.{O}}', r"Ȯ")
    bib = reverse_replace(bib, r'{\.{Z}}', r"Ż")
    bib = reverse_replace(bib, r'{\.{\a}}', r"Ȧ")
    bib = reverse_replace(bib, r'{\.{\c}}', r"Ċ")
    bib = reverse_replace(bib, r'{\.{\e}}', r"Ė")
    bib = reverse_replace(bib, r'{\.{\G}}', r"Ġ")
    bib = reverse_replace(bib, r'{\.{\O}}', r"Ȯ")
    bib = reverse_replace(bib, r'{\.{\Z}}', r"Ż")
    bib = reverse_replace(bib, r'{\. A}', r"Ȧ")
    bib = reverse_replace(bib, r'{\. C}', r"Ċ")
    bib = reverse_replace(bib, r'{\. E}', r"Ė")
    bib = reverse_replace(bib, r'{\. G}', r"Ġ")
    bib = reverse_replace(bib, r'{\. O}', r"Ȯ")
    bib = reverse_replace(bib, r'{\. Z}', r"Ż")
    bib = reverse_replace(bib, r'{\.A}', r"Ȧ")
    bib = reverse_replace(bib, r'{\.C}', r"Ċ")
    bib = reverse_replace(bib, r'{\.E}', r"Ė")
    bib = reverse_replace(bib, r'{\.G}', r"Ġ")
    bib = reverse_replace(bib, r'{\.O}', r"Ȯ")
    bib = reverse_replace(bib, r'{\.Z}', r"Ż")
    bib = reverse_replace(bib, r'\.{a}', r"ȧ")
    bib = reverse_replace(bib, r'\.{c}', r"ċ")
    bib = reverse_replace(bib, r'\.{e}', r"ė")
    bib = reverse_replace(bib, r'\.{g}', r"ġ")
    bib = reverse_replace(bib, r'\.{o}', r"ȯ")
    bib = reverse_replace(bib, r'\.{z}', r"ż")
    bib = reverse_replace(bib, r'\.a', r"ȧ")
    bib = reverse_replace(bib, r'\.c', r"ċ")
    bib = reverse_replace(bib, r'\.e', r"ė")
    bib = reverse_replace(bib, r'\.g', r"ġ")
    bib = reverse_replace(bib, r'\.o', r"ȯ")
    bib = reverse_replace(bib, r'\.z', r"ż")
    bib = reverse_replace(bib, r'\.{\a}', r"ȧ")
    bib = reverse_replace(bib, r'\.{\c}', r"ċ")
    bib = reverse_replace(bib, r'\.{\e}', r"ė")
    bib = reverse_replace(bib, r'\.{\g}', r"ġ")
    bib = reverse_replace(bib, r'\.{\o}', r"ȯ")
    bib = reverse_replace(bib, r'\.{\z}', r"ż")
    bib = reverse_replace(bib, r'\.{A}', r"Ȧ")
    bib = reverse_replace(bib, r'\.{C}', r"Ċ")
    bib = reverse_replace(bib, r'\.{E}', r"Ė")
    bib = reverse_replace(bib, r'\.{G}', r"Ġ")
    bib = reverse_replace(bib, r'\.{O}', r"Ȯ")
    bib = reverse_replace(bib, r'\.{Z}', r"Ż")
    bib = reverse_replace(bib, r'\.A', r"Ȧ")
    bib = reverse_replace(bib, r'\.C', r"Ċ")
    bib = reverse_replace(bib, r'\.E', r"Ė")
    bib = reverse_replace(bib, r'\.G', r"Ġ")
    bib = reverse_replace(bib, r'\.O', r"Ȯ")
    bib = reverse_replace(bib, r'\.Z', r"Ż")
    bib = reverse_replace(bib, r'\.{\a}', r"Ȧ")
    bib = reverse_replace(bib, r'\.{\c}', r"Ċ")
    bib = reverse_replace(bib, r'\.{\e}', r"Ė")
    bib = reverse_replace(bib, r'\.{\G}', r"Ġ")
    bib = reverse_replace(bib, r'\.{\O}', r"Ȯ")
    bib = reverse_replace(bib, r'\.{\Z}', r"Ż")
    bib = reverse_replace(bib, r'{\d{a}}', r"ạ")
    bib = reverse_replace(bib, r'{\d{e}}', r"ẹ")
    bib = reverse_replace(bib, r'{\d{h}}', r"ḥ")
    bib = reverse_replace(bib, r'{\d{i}}', r"ị")
    bib = reverse_replace(bib, r'{\d{m}}', r"ṃ")
    bib = reverse_replace(bib, r'{\d{n}}', r"ṇ")
    bib = reverse_replace(bib, r'{\d{o}}', r"ọ")
    bib = reverse_replace(bib, r'{\d{r}}', r"ṛ")
    bib = reverse_replace(bib, r'{\d{s}}', r"ṣ")
    bib = reverse_replace(bib, r'{\d{u}}', r"ụ")
    bib = reverse_replace(bib, r'{\d{\a}}', r"ạ")
    bib = reverse_replace(bib, r'{\d{\e}}', r"ẹ")
    bib = reverse_replace(bib, r'{\d{\h}}', r"ḥ")
    bib = reverse_replace(bib, r'{\d{\i}}', r"ị")
    bib = reverse_replace(bib, r'{\d{\m}}', r"ṃ")
    bib = reverse_replace(bib, r'{\d{\n}}', r"ṇ")
    bib = reverse_replace(bib, r'{\d{\o}}', r"ọ")
    bib = reverse_replace(bib, r'{\d{\r}}', r"ṛ")
    bib = reverse_replace(bib, r'{\d{\s}}', r"ṣ")
    bib = reverse_replace(bib, r'{\d{\u}}', r"ụ")
    bib = reverse_replace(bib, r'{\d a}', r"ạ")
    bib = reverse_replace(bib, r'{\d e}', r"ẹ")
    bib = reverse_replace(bib, r'{\d h}', r"ḥ")
    bib = reverse_replace(bib, r'{\d i}', r"ị")
    bib = reverse_replace(bib, r'{\d m}', r"ṃ")
    bib = reverse_replace(bib, r'{\d n}', r"ṇ")
    bib = reverse_replace(bib, r'{\d o}', r"ọ")
    bib = reverse_replace(bib, r'{\d r}', r"ṛ")
    bib = reverse_replace(bib, r'{\d s}', r"ṣ")
    bib = reverse_replace(bib, r'{\d u}', r"ụ")
    bib = reverse_replace(bib, r'{\da}', r"ạ")
    bib = reverse_replace(bib, r'{\de}', r"ẹ")
    bib = reverse_replace(bib, r'{\dh}', r"ḥ")
    bib = reverse_replace(bib, r'{\di}', r"ị")
    bib = reverse_replace(bib, r'{\dm}', r"ṃ")
    bib = reverse_replace(bib, r'{\dn}', r"ṇ")
    bib = reverse_replace(bib, r'{\do}', r"ọ")
    bib = reverse_replace(bib, r'{\dr}', r"ṛ")
    bib = reverse_replace(bib, r'{\ds}', r"ṣ")
    bib = reverse_replace(bib, r'{\du}', r"ụ")
    bib = reverse_replace(bib, r'{\d{A}}', r"Ạ")
    bib = reverse_replace(bib, r'{\d{E}}', r"Ẹ")
    bib = reverse_replace(bib, r'{\d{H}}', r"Ḥ")
    bib = reverse_replace(bib, r'{\d{I}}', r"Ị")
    bib = reverse_replace(bib, r'{\d{M}}', r"Ṃ")
    bib = reverse_replace(bib, r'{\d{N}}', r"Ṇ")
    bib = reverse_replace(bib, r'{\d{O}}', r"Ọ")
    bib = reverse_replace(bib, r'{\d{R}}', r"Ṛ")
    bib = reverse_replace(bib, r'{\d{S}}', r"Ṣ")
    bib = reverse_replace(bib, r'{\d{U}}', r"Ụ")
    bib = reverse_replace(bib, r'{\d{\a}}', r"Ạ")
    bib = reverse_replace(bib, r'{\d{\e}}', r"Ẹ")
    bib = reverse_replace(bib, r'{\d{\H}}', r"Ḥ")
    bib = reverse_replace(bib, r'{\d{\I}}', r"Ị")
    bib = reverse_replace(bib, r'{\d{\M}}', r"Ṃ")
    bib = reverse_replace(bib, r'{\d{\n}}', r"Ṇ")
    bib = reverse_replace(bib, r'{\d{\O}}', r"Ọ")
    bib = reverse_replace(bib, r'{\d{\r}}', r"Ṛ")
    bib = reverse_replace(bib, r'{\d{\S}}', r"Ṣ")
    bib = reverse_replace(bib, r'{\d{\U}}', r"Ụ")
    bib = reverse_replace(bib, r'{\d A}', r"Ạ")
    bib = reverse_replace(bib, r'{\d E}', r"Ẹ")
    bib = reverse_replace(bib, r'{\d H}', r"Ḥ")
    bib = reverse_replace(bib, r'{\d I}', r"Ị")
    bib = reverse_replace(bib, r'{\d M}', r"Ṃ")
    bib = reverse_replace(bib, r'{\d N}', r"Ṇ")
    bib = reverse_replace(bib, r'{\d O}', r"Ọ")
    bib = reverse_replace(bib, r'{\d R}', r"Ṛ")
    bib = reverse_replace(bib, r'{\d S}', r"Ṣ")
    bib = reverse_replace(bib, r'{\d U}', r"Ụ")
    bib = reverse_replace(bib, r'{\dA}', r"Ạ")
    bib = reverse_replace(bib, r'{\dE}', r"Ẹ")
    bib = reverse_replace(bib, r'{\dH}', r"Ḥ")
    bib = reverse_replace(bib, r'{\dI}', r"Ị")
    bib = reverse_replace(bib, r'{\dM}', r"Ṃ")
    bib = reverse_replace(bib, r'{\dN}', r"Ṇ")
    bib = reverse_replace(bib, r'{\dO}', r"Ọ")
    bib = reverse_replace(bib, r'{\dR}', r"Ṛ")
    bib = reverse_replace(bib, r'{\dS}', r"Ṣ")
    bib = reverse_replace(bib, r'{\dU}', r"Ụ")
    bib = reverse_replace(bib, r'\d{a}', r"ạ")
    bib = reverse_replace(bib, r'\d{e}', r"ẹ")
    bib = reverse_replace(bib, r'\d{h}', r"ḥ")
    bib = reverse_replace(bib, r'\d{i}', r"ị")
    bib = reverse_replace(bib, r'\d{m}', r"ṃ")
    bib = reverse_replace(bib, r'\d{n}', r"ṇ")
    bib = reverse_replace(bib, r'\d{o}', r"ọ")
    bib = reverse_replace(bib, r'\d{r}', r"ṛ")
    bib = reverse_replace(bib, r'\d{s}', r"ṣ")
    bib = reverse_replace(bib, r'\d{u}', r"ụ")
    bib = reverse_replace(bib, r'\da', r"ạ")
    bib = reverse_replace(bib, r'\de', r"ẹ")
    bib = reverse_replace(bib, r'\dh', r"ḥ")
    bib = reverse_replace(bib, r'\di', r"ị")
    bib = reverse_replace(bib, r'\dm', r"ṃ")
    bib = reverse_replace(bib, r'\dn', r"ṇ")
    bib = reverse_replace(bib, r'\do', r"ọ")
    bib = reverse_replace(bib, r'\dr', r"ṛ")
    bib = reverse_replace(bib, r'\ds', r"ṣ")
    bib = reverse_replace(bib, r'\du', r"ụ")
    bib = reverse_replace(bib, r'\d{\a}', r"ạ")
    bib = reverse_replace(bib, r'\d{\e}', r"ẹ")
    bib = reverse_replace(bib, r'\d{\h}', r"ḥ")
    bib = reverse_replace(bib, r'\d{\i}', r"ị")
    bib = reverse_replace(bib, r'\d{\m}', r"ṃ")
    bib = reverse_replace(bib, r'\d{\n}', r"ṇ")
    bib = reverse_replace(bib, r'\d{\o}', r"ọ")
    bib = reverse_replace(bib, r'\d{\r}', r"ṛ")
    bib = reverse_replace(bib, r'\d{\s}', r"ṣ")
    bib = reverse_replace(bib, r'\d{\u}', r"ụ")
    bib = reverse_replace(bib, r'\d{A}', r"Ạ")
    bib = reverse_replace(bib, r'\d{E}', r"Ẹ")
    bib = reverse_replace(bib, r'\d{H}', r"Ḥ")
    bib = reverse_replace(bib, r'\d{I}', r"Ị")
    bib = reverse_replace(bib, r'\d{M}', r"Ṃ")
    bib = reverse_replace(bib, r'\d{N}', r"Ṇ")
    bib = reverse_replace(bib, r'\d{O}', r"Ọ")
    bib = reverse_replace(bib, r'\d{R}', r"Ṛ")
    bib = reverse_replace(bib, r'\d{S}', r"Ṣ")
    bib = reverse_replace(bib, r'\d{U}', r"Ụ")
    bib = reverse_replace(bib, r'\dA', r"Ạ")
    bib = reverse_replace(bib, r'\dE', r"Ẹ")
    bib = reverse_replace(bib, r'\dH', r"Ḥ")
    bib = reverse_replace(bib, r'\dI', r"Ị")
    bib = reverse_replace(bib, r'\dM', r"Ṃ")
    bib = reverse_replace(bib, r'\dN', r"Ṇ")
    bib = reverse_replace(bib, r'\dO', r"Ọ")
    bib = reverse_replace(bib, r'\dR', r"Ṛ")
    bib = reverse_replace(bib, r'\dS', r"Ṣ")
    bib = reverse_replace(bib, r'\dU', r"Ụ")
    bib = reverse_replace(bib, r'\d{\a}', r"Ạ")
    bib = reverse_replace(bib, r'\d{\e}', r"Ẹ")
    bib = reverse_replace(bib, r'\d{\H}', r"Ḥ")
    bib = reverse_replace(bib, r'\d{\I}', r"Ị")
    bib = reverse_replace(bib, r'\d{\M}', r"Ṃ")
    bib = reverse_replace(bib, r'\d{\n}', r"Ṇ")
    bib = reverse_replace(bib, r'\d{\O}', r"Ọ")
    bib = reverse_replace(bib, r'\d{\r}', r"Ṛ")
    bib = reverse_replace(bib, r'\d{\S}', r"Ṣ")
    bib = reverse_replace(bib, r'\d{\U}', r"Ụ")
    bib = reverse_replace(bib, r'{\u{a}}', r"ă")
    bib = reverse_replace(bib, r'{\u{e}}', r"ĕ")
    bib = reverse_replace(bib, r'{\u{g}}', r"ğ")
    bib = reverse_replace(bib, r'{\u{i}}', r"ĭ")
    bib = reverse_replace(bib, r'{\u{o}}', r"ŏ")
    bib = reverse_replace(bib, r'{\u{u}}', r"ŭ")
    bib = reverse_replace(bib, r'{\u{\a}}', r"ă")
    bib = reverse_replace(bib, r'{\u{\e}}', r"ĕ")
    bib = reverse_replace(bib, r'{\u{\g}}', r"ğ")
    bib = reverse_replace(bib, r'{\u{\i}}', r"ĭ")
    bib = reverse_replace(bib, r'{\u{\o}}', r"ŏ")
    bib = reverse_replace(bib, r'{\u{\u}}', r"ŭ")
    bib = reverse_replace(bib, r'{\u a}', r"ă")
    bib = reverse_replace(bib, r'{\u e}', r"ĕ")
    bib = reverse_replace(bib, r'{\u g}', r"ğ")
    bib = reverse_replace(bib, r'{\u i}', r"ĭ")
    bib = reverse_replace(bib, r'{\u o}', r"ŏ")
    bib = reverse_replace(bib, r'{\u u}', r"ŭ")
    bib = reverse_replace(bib, r'{\ua}', r"ă")
    bib = reverse_replace(bib, r'{\ue}', r"ĕ")
    bib = reverse_replace(bib, r'{\ug}', r"ğ")
    bib = reverse_replace(bib, r'{\ui}', r"ĭ")
    bib = reverse_replace(bib, r'{\uo}', r"ŏ")
    bib = reverse_replace(bib, r'{\uu}', r"ŭ")
    bib = reverse_replace(bib, r'{\u{A}}', r"Ă")
    bib = reverse_replace(bib, r'{\u{E}}', r"Ĕ")
    bib = reverse_replace(bib, r'{\u{G}}', r"Ğ")
    bib = reverse_replace(bib, r'{\u{I}}', r"Ĭ")
    bib = reverse_replace(bib, r'{\u{O}}', r"Ŏ")
    bib = reverse_replace(bib, r'{\u{U}}', r"Ŭ")
    bib = reverse_replace(bib, r'{\u{\a}}', r"Ă")
    bib = reverse_replace(bib, r'{\u{\e}}', r"Ĕ")
    bib = reverse_replace(bib, r'{\u{\G}}', r"Ğ")
    bib = reverse_replace(bib, r'{\u{\I}}', r"Ĭ")
    bib = reverse_replace(bib, r'{\u{\O}}', r"Ŏ")
    bib = reverse_replace(bib, r'{\u{\U}}', r"Ŭ")
    bib = reverse_replace(bib, r'{\u A}', r"Ă")
    bib = reverse_replace(bib, r'{\u E}', r"Ĕ")
    bib = reverse_replace(bib, r'{\u G}', r"Ğ")
    bib = reverse_replace(bib, r'{\u I}', r"Ĭ")
    bib = reverse_replace(bib, r'{\u O}', r"Ŏ")
    bib = reverse_replace(bib, r'{\u U}', r"Ŭ")
    bib = reverse_replace(bib, r'{\uA}', r"Ă")
    bib = reverse_replace(bib, r'{\uE}', r"Ĕ")
    bib = reverse_replace(bib, r'{\uG}', r"Ğ")
    bib = reverse_replace(bib, r'{\uI}', r"Ĭ")
    bib = reverse_replace(bib, r'{\uO}', r"Ŏ")
    bib = reverse_replace(bib, r'{\uU}', r"Ŭ")
    bib = reverse_replace(bib, r'\u{a}', r"ă")
    bib = reverse_replace(bib, r'\u{e}', r"ĕ")
    bib = reverse_replace(bib, r'\u{g}', r"ğ")
    bib = reverse_replace(bib, r'\u{i}', r"ĭ")
    bib = reverse_replace(bib, r'\u{o}', r"ŏ")
    bib = reverse_replace(bib, r'\u{u}', r"ŭ")
    bib = reverse_replace(bib, r'\ua', r"ă")
    bib = reverse_replace(bib, r'\ue', r"ĕ")
    bib = reverse_replace(bib, r'\ug', r"ğ")
    bib = reverse_replace(bib, r'\ui', r"ĭ")
    bib = reverse_replace(bib, r'\uo', r"ŏ")
    bib = reverse_replace(bib, r'\uu', r"ŭ")
    bib = reverse_replace(bib, r'\u{\a}', r"ă")
    bib = reverse_replace(bib, r'\u{\e}', r"ĕ")
    bib = reverse_replace(bib, r'\u{\g}', r"ğ")
    bib = reverse_replace(bib, r'\u{\i}', r"ĭ")
    bib = reverse_replace(bib, r'\u{\o}', r"ŏ")
    bib = reverse_replace(bib, r'\u{\u}', r"ŭ")
    bib = reverse_replace(bib, r'\u{A}', r"Ă")
    bib = reverse_replace(bib, r'\u{E}', r"Ĕ")
    bib = reverse_replace(bib, r'\u{G}', r"Ğ")
    bib = reverse_replace(bib, r'\u{I}', r"Ĭ")
    bib = reverse_replace(bib, r'\u{O}', r"Ŏ")
    bib = reverse_replace(bib, r'\u{U}', r"Ŭ")
    bib = reverse_replace(bib, r'\uA', r"Ă")
    bib = reverse_replace(bib, r'\uE', r"Ĕ")
    bib = reverse_replace(bib, r'\uG', r"Ğ")
    bib = reverse_replace(bib, r'\uI', r"Ĭ")
    bib = reverse_replace(bib, r'\uO', r"Ŏ")
    bib = reverse_replace(bib, r'\uU', r"Ŭ")
    bib = reverse_replace(bib, r'\u{\a}', r"Ă")
    bib = reverse_replace(bib, r'\u{\e}', r"Ĕ")
    bib = reverse_replace(bib, r'\u{\G}', r"Ğ")
    bib = reverse_replace(bib, r'\u{\I}', r"Ĭ")
    bib = reverse_replace(bib, r'\u{\O}', r"Ŏ")
    bib = reverse_replace(bib, r'\u{\U}', r"Ŭ")
    bib = reverse_replace(bib, r'{\H{o}}', r"ő")
    bib = reverse_replace(bib, r'{\H{u}}', r"ű")
    bib = reverse_replace(bib, r'{\H{\o}}', r"ő")
    bib = reverse_replace(bib, r'{\H{\u}}', r"ű")
    bib = reverse_replace(bib, r'{\H o}', r"ő")
    bib = reverse_replace(bib, r'{\H u}', r"ű")
    bib = reverse_replace(bib, r'{\Ho}', r"ő")
    bib = reverse_replace(bib, r'{\Hu}', r"ű")
    bib = reverse_replace(bib, r'{\H{O}}', r"Ő")
    bib = reverse_replace(bib, r'{\H{U}}', r"Ű")
    bib = reverse_replace(bib, r'{\H{\O}}', r"Ő")
    bib = reverse_replace(bib, r'{\H{\U}}', r"Ű")
    bib = reverse_replace(bib, r'{\H O}', r"Ő")
    bib = reverse_replace(bib, r'{\H U}', r"Ű")
    bib = reverse_replace(bib, r'{\HO}', r"Ő")
    bib = reverse_replace(bib, r'{\HU}', r"Ű")
    bib = reverse_replace(bib, r'\H{o}', r"ő")
    bib = reverse_replace(bib, r'\H{u}', r"ű")
    bib = reverse_replace(bib, r'\Ho', r"ő")
    bib = reverse_replace(bib, r'\Hu', r"ű")
    bib = reverse_replace(bib, r'\H{\o}', r"ő")
    bib = reverse_replace(bib, r'\H{\u}', r"ű")
    bib = reverse_replace(bib, r'\H{O}', r"Ő")
    bib = reverse_replace(bib, r'\H{U}', r"Ű")
    bib = reverse_replace(bib, r'\HO', r"Ő")
    bib = reverse_replace(bib, r'\HU', r"Ű")
    bib = reverse_replace(bib, r'\H{\O}', r"Ő")
    bib = reverse_replace(bib, r'\H{\U}', r"Ű")
    bib = reverse_replace(bib, r'a{\v}', r"â")
    bib = reverse_replace(bib, r'A{\v}', r"Â")
    bib = reverse_replace(bib, r'{\v{a}}', r"ǎ")
    bib = reverse_replace(bib, r'{\v{\a}}', r"ǎ")
    bib = reverse_replace(bib, r'{\v a}', r"ǎ")
    bib = reverse_replace(bib, r'{\va}', r"ǎ")
    bib = reverse_replace(bib, r'\v{a}', r"ǎ")
    bib = reverse_replace(bib, r'\va', r"ǎ")
    bib = reverse_replace(bib, r'\v{\a}', r"ǎ")
    bib = reverse_replace(bib, r'{\v{A}}', r"Ǎ")
    bib = reverse_replace(bib, r'{\v{\a}}', r"Ǎ")
    bib = reverse_replace(bib, r'{\v A}', r"Ǎ")
    bib = reverse_replace(bib, r'{\vA}', r"Ǎ")
    bib = reverse_replace(bib, r'\v{A}', r"Ǎ")
    bib = reverse_replace(bib, r'\vA', r"Ǎ")
    bib = reverse_replace(bib, r'\v{\a}', r"Ǎ")
    bib = reverse_replace(bib, r'{\v{c}}', r"č")
    bib = reverse_replace(bib, r'{\v{\c}}', r"č")
    bib = reverse_replace(bib, r'{\v c}', r"č")
    bib = reverse_replace(bib, r'{\vc}', r"č")
    bib = reverse_replace(bib, r'\v{c}', r"č")
    bib = reverse_replace(bib, r'\vc', r"č")
    bib = reverse_replace(bib, r'\v{\c}', r"č")
    bib = reverse_replace(bib, r'{\v{C}}', r"Č")
    bib = reverse_replace(bib, r'{\v{\c}}', r"Č")
    bib = reverse_replace(bib, r'{\v C}', r"Č")
    bib = reverse_replace(bib, r'{\vC}', r"Č")
    bib = reverse_replace(bib, r'\v{C}', r"Č")
    bib = reverse_replace(bib, r'\vC', r"Č")
    bib = reverse_replace(bib, r'\v{\c}', r"Č")
    bib = reverse_replace(bib, r'e{\v}', r"ê")
    bib = reverse_replace(bib, r'{\v{e}}', r"ě")
    bib = reverse_replace(bib, r'{\v{\e}}', r"ě")
    bib = reverse_replace(bib, r'{\v e}', r"ě")
    bib = reverse_replace(bib, r'{\ve}', r"ě")
    bib = reverse_replace(bib, r'\v{e}', r"ě")
    bib = reverse_replace(bib, r'\ve', r"ě")
    bib = reverse_replace(bib, r'\v{\e}', r"ě")
    bib = reverse_replace(bib, r'E{\v}', r"Ê")
    bib = reverse_replace(bib, r'{\v{E}}', r"Ě")
    bib = reverse_replace(bib, r'{\v{\e}}', r"Ě")
    bib = reverse_replace(bib, r'{\v E}', r"Ě")
    bib = reverse_replace(bib, r'{\vE}', r"Ě")
    bib = reverse_replace(bib, r'\v{E}', r"Ě")
    bib = reverse_replace(bib, r'\vE', r"Ě")
    bib = reverse_replace(bib, r'\v{\e}', r"Ě")
    bib = reverse_replace(bib, r'{\v{j}}', r"ǰ")
    bib = reverse_replace(bib, r'{\v{\j}}', r"ǰ")
    bib = reverse_replace(bib, r'{\v j}', r"ǰ")
    bib = reverse_replace(bib, r'{\vj}', r"ǰ")
    bib = reverse_replace(bib, r'\v{j}', r"ǰ")
    bib = reverse_replace(bib, r'\vj', r"ǰ")
    bib = reverse_replace(bib, r'\v{\j}', r"ǰ")
    bib = reverse_replace(bib, r'{\v{r}}', r"ř")
    bib = reverse_replace(bib, r'{\v{\r}}', r"ř")
    bib = reverse_replace(bib, r'{\v r}', r"ř")
    bib = reverse_replace(bib, r'{\vr}', r"ř")
    bib = reverse_replace(bib, r'\v{r}', r"ř")
    bib = reverse_replace(bib, r'\vr', r"ř")
    bib = reverse_replace(bib, r'\v{\r}', r"ř")
    bib = reverse_replace(bib, r'{\v{R}}', r"Ř")
    bib = reverse_replace(bib, r'{\v{\r}}', r"Ř")
    bib = reverse_replace(bib, r'{\v R}}', r"Ř")
    bib = reverse_replace(bib, r'{\vR}}', r"Ř")
    bib = reverse_replace(bib, r'\v{R}', r"Ř")
    bib = reverse_replace(bib, r'\vR', r"Ř")
    bib = reverse_replace(bib, r'\v{\r}', r"Ř")
    bib = reverse_replace(bib, r'{\v{s}}', r"š")
    bib = reverse_replace(bib, r'{\v{\s}}', r"š")
    bib = reverse_replace(bib, r'{\v s}', r"š")
    bib = reverse_replace(bib, r'{\vs}', r"š")
    bib = reverse_replace(bib, r'\v{s}', r"š")
    bib = reverse_replace(bib, r'\vs', r"š")
    bib = reverse_replace(bib, r'\v{\s}', r"š")
    bib = reverse_replace(bib, r'{\v{S}}', r"Š")
    bib = reverse_replace(bib, r'{\v S}', r"Š")
    bib = reverse_replace(bib, r'{\vS}', r"Š")
    bib = reverse_replace(bib, r'{\v{\S}}', r"Š")
    bib = reverse_replace(bib, r'\v{S}', r"Š")
    bib = reverse_replace(bib, r'\vS', r"Š")
    bib = reverse_replace(bib, r'\v{\S}', r"Š")
    bib = reverse_replace(bib, r'{\v{z}}', r"ž")
    bib = reverse_replace(bib, r'{\v{\z}}', r"ž")
    bib = reverse_replace(bib, r'{\v z}', r"ž")
    bib = reverse_replace(bib, r'{\vz}', r"ž")
    bib = reverse_replace(bib, r'\v{z}', r"ž")
    bib = reverse_replace(bib, r'\vz', r"ž")
    bib = reverse_replace(bib, r'\v{\z}', r"ž")
    bib = reverse_replace(bib, r'{\v{Z}}', r"Ž")
    bib = reverse_replace(bib, r'{\v{\Z}}', r"Ž")
    bib = reverse_replace(bib, r'{\v Z}', r"Ž")
    bib = reverse_replace(bib, r'{\vZ}', r"Ž")
    bib = reverse_replace(bib, r'\v{Z}', r"Ž")
    bib = reverse_replace(bib, r'\vZ', r"Ž")
    bib = reverse_replace(bib, r'\v{\Z}', r"Ž")
    bib = reverse_replace(bib, r'{\c{s}}', r"ş")
    bib = reverse_replace(bib, r'{\c{\s}}', r"ş")
    bib = reverse_replace(bib, r'{\c s}', r"ş")
    bib = reverse_replace(bib, r'\c{s}', r"ş")
    bib = reverse_replace(bib, r'\cs', r"ş")
    bib = reverse_replace(bib, r'\c{\s}', r"ş")
    bib = reverse_replace(bib, r's{\c}', r"ş")
    bib = reverse_replace(bib, r's{c}', r"ş")
    bib = reverse_replace(bib, r'{\c{S}}', r"Ş")
    bib = reverse_replace(bib, r'{\c{\S}}', r"Ş")
    bib = reverse_replace(bib, r'{\c S}', r"Ş")
    bib = reverse_replace(bib, r'{\cS}', r"Ş")
    bib = reverse_replace(bib, r'\c{S}', r"Ş")
    bib = reverse_replace(bib, r'\cS', r"Ş")
    bib = reverse_replace(bib, r'\c{\S}', r"Ş")
    bib = reverse_replace(bib, r'S{\c}', r"Ş")
    bib = reverse_replace(bib, r'S{c}', r"Ş")
    bib = reverse_replace(bib, r'{\c{e}}', r"ȩ")
    bib = reverse_replace(bib, r'{\c{\e}}', r"ȩ")
    bib = reverse_replace(bib, r'{\c e}', r"ȩ")
    bib = reverse_replace(bib, r'{\ce}', r"ȩ")
    bib = reverse_replace(bib, r'\c{e}', r"ȩ")
    bib = reverse_replace(bib, r'\ce', r"ȩ")
    bib = reverse_replace(bib, r'\c{\e}', r"ȩ")
    bib = reverse_replace(bib, r'e{\c}', r"ȩ")
    bib = reverse_replace(bib, r'e{c}', r"ȩ")
    bib = reverse_replace(bib, r'{\c{E}}', r"Ȩ")
    bib = reverse_replace(bib, r'{\c{\e}}', r"Ȩ")
    bib = reverse_replace(bib, r'{\c E}', r"Ȩ")
    bib = reverse_replace(bib, r'{\cE}', r"Ȩ")
    bib = reverse_replace(bib, r'\c{E}', r"Ȩ")
    bib = reverse_replace(bib, r'\cE', r"Ȩ")
    bib = reverse_replace(bib, r'\c{\e}', r"Ȩ")
    bib = reverse_replace(bib, r'E{\c}', r"Ȩ")
    bib = reverse_replace(bib, r'E{c}', r"Ȩ")
    bib = reverse_replace(bib, r'{\c{c}}', r"ç")
    bib = reverse_replace(bib, r'{\c{\c}}', r"ç")
    bib = reverse_replace(bib, r'{\c c}', r"ç")
    bib = reverse_replace(bib, r'{\cc}', r"ç")
    bib = reverse_replace(bib, r'\c{c}', r"ç")
    bib = reverse_replace(bib, r'\cc', r"ç")
    bib = reverse_replace(bib, r'\c{\c}', r"ç")
    bib = reverse_replace(bib, r'c{\c}', r"ç")
    bib = reverse_replace(bib, r'c{c}', r"ç")
    bib = reverse_replace(bib, r'{\c{C}}', r"Ç")
    bib = reverse_replace(bib, r'{\c{\c}}', r"Ç")
    bib = reverse_replace(bib, r'{\c C}', r"Ç")
    bib = reverse_replace(bib, r'{\cC}', r"Ç")
    bib = reverse_replace(bib, r'\c{C}', r"Ç")
    bib = reverse_replace(bib, r'\cC', r"Ç")
    bib = reverse_replace(bib, r'\c{\c}', r"Ç")
    bib = reverse_replace(bib, r'C{\c}', r"Ç")
    bib = reverse_replace(bib, r'C{c}', r"Ç")
    bib = reverse_replace(bib, r'{\~{a}}', r"ã")
    bib = reverse_replace(bib, r'{\~{o}}', r"õ")
    bib = reverse_replace(bib, r'{\~{\a}}', r"ã")
    bib = reverse_replace(bib, r'{\~{\o}}', r"õ")
    bib = reverse_replace(bib, r'{\~ a}', r"ã")
    bib = reverse_replace(bib, r'{\~ o}', r"õ")
    bib = reverse_replace(bib, r'{\~a}', r"ã")
    bib = reverse_replace(bib, r'{\~o}', r"õ")
    bib = reverse_replace(bib, r'{\~{A}}', r"Ã")
    bib = reverse_replace(bib, r'{\~{O}}', r"Õ")
    bib = reverse_replace(bib, r'{\~{\a}}', r"Ã")
    bib = reverse_replace(bib, r'{\~{\O}}', r"Õ")
    bib = reverse_replace(bib, r'{\~ A}', r"Ã")
    bib = reverse_replace(bib, r'{\~ O}', r"Õ")
    bib = reverse_replace(bib, r'{\~A}', r"Ã")
    bib = reverse_replace(bib, r'{\~O}', r"Õ")
    bib = reverse_replace(bib, r'\~{a}', r"ã")
    bib = reverse_replace(bib, r'\~{o}', r"õ")
    bib = reverse_replace(bib, r'\~a', r"ã")
    bib = reverse_replace(bib, r'\~o', r"õ")
    bib = reverse_replace(bib, r'\~{\a}', r"ã")
    bib = reverse_replace(bib, r'\~{\o}', r"õ")
    bib = reverse_replace(bib, r'\~{A}', r"Ã")
    bib = reverse_replace(bib, r'\~{O}', r"Õ")
    bib = reverse_replace(bib, r'\~A', r"Ã")
    bib = reverse_replace(bib, r'\~O', r"Õ")
    bib = reverse_replace(bib, r'\~{\a}', r"Ã")
    bib = reverse_replace(bib, r'\~{\O}', r"Õ")
    bib = reverse_replace(bib, r'{\~{n}}', r"ñ")
    bib = reverse_replace(bib, r'{\~{\n}}', r"ñ")
    bib = reverse_replace(bib, r'{\~ n}', r"ñ")
    bib = reverse_replace(bib, r'{\~n}', r"ñ")
    bib = reverse_replace(bib, r'\~{n}', r"ñ")
    bib = reverse_replace(bib, r'\~n', r"ñ")
    bib = reverse_replace(bib, r'\~{\n}', r"ñ")
    bib = reverse_replace(bib, r'{\~{N}}', r"Ñ")
    bib = reverse_replace(bib, r'{\~{\n}}', r"Ñ")
    bib = reverse_replace(bib, r'{\~ N}', r"Ñ")
    bib = reverse_replace(bib, r'{\~N}', r"Ñ")
    bib = reverse_replace(bib, r'\~{N}', r"Ñ")
    bib = reverse_replace(bib, r'\~N', r"Ñ")
    bib = reverse_replace(bib, r'\~{\n}', r"Ñ")
    bib = reverse_replace(bib, r'{\aa}', r"å")
    bib = reverse_replace(bib, r'\aa', r"å")
    bib = reverse_replace(bib, r'{\aA}', r"Å")
    bib = reverse_replace(bib, r'\aA', r"Å")
    bib = reverse_replace(bib, r'{\r{a}}', r"å")
    bib = reverse_replace(bib, r'{\r{\a}}', r"å")
    bib = reverse_replace(bib, r'{\r a}', r"å")
    bib = reverse_replace(bib, r'{\ra}', r"å")
    bib = reverse_replace(bib, r'\r{a}', r"å")
    bib = reverse_replace(bib, r'\ra', r"å")
    bib = reverse_replace(bib, r'\r{\a}', r"å")
    bib = reverse_replace(bib, r'{\r{A}}', r"Å")
    bib = reverse_replace(bib, r'{\r{\a}}', r"Å")
    bib = reverse_replace(bib, r'{\r A}', r"Å")
    bib = reverse_replace(bib, r'{\rA}', r"Å")
    bib = reverse_replace(bib, r'\r{A}', r"Å")
    bib = reverse_replace(bib, r'\rA', r"Å")
    bib = reverse_replace(bib, r'\r{\a}', r"Å")
    bib = reverse_replace(bib, r'{\r{u}}', r"ů")
    bib = reverse_replace(bib, r'{\r{\u}}', r"ů")
    bib = reverse_replace(bib, r'{\r u}', r"ů")
    bib = reverse_replace(bib, r'{\ru}', r"ů")
    bib = reverse_replace(bib, r'\r{u}', r"ů")
    bib = reverse_replace(bib, r'\ru', r"ů")
    bib = reverse_replace(bib, r'\r{\u}', r"ů")
    bib = reverse_replace(bib, r'{\r{U}}', r"Ů")
    bib = reverse_replace(bib, r'{\r{\U}}', r"Ů")
    bib = reverse_replace(bib, r'{\r U}', r"Ů")
    bib = reverse_replace(bib, r'{\rU}', r"Ů")
    bib = reverse_replace(bib, r'\r{U}', r"Ů")
    bib = reverse_replace(bib, r'\rU', r"Ů")
    bib = reverse_replace(bib, r'\r{\U}', r"Ů")
    bib = reverse_replace(bib, r'{\ae}', r"æ")
    bib = reverse_replace(bib, r'\ae', r"æ")
    bib = reverse_replace(bib, r'{\aE}', r"Æ")
    bib = reverse_replace(bib, r'\aE', r"Æ")
    bib = reverse_replace(bib, r'{\oe}', r"œ")
    bib = reverse_replace(bib, r'\oe', r"œ")
    bib = reverse_replace(bib, r'{\OE}', r"Œ")
    bib = reverse_replace(bib, r'\OE', r"Œ")
    bib = reverse_replace(bib, r'{\o}', r"ø")
    bib = reverse_replace(bib, r'\o', r"ø")
    bib = reverse_replace(bib, r'\o{}', r"ø")
    bib = reverse_replace(bib, r'{\O}', r"Ø")
    bib = reverse_replace(bib, r'\O', r"Ø")
    bib = reverse_replace(bib, r'\O{}', r"Ø")
    bib = reverse_replace(bib, r'{\ss}', r"ß")
    bib = reverse_replace(bib, r'\ss', r"ß")
    bib = reverse_replace(bib, r'{\l}', r"ł")
    bib = reverse_replace(bib, r'\l', r"ł")
    bib = reverse_replace(bib, r'{\L}', r"Ł")
    bib = reverse_replace(bib, r'\L', r"Ł")
    bib = reverse_replace(bib, r'{\i}', r"ı")
    bib = reverse_replace(bib, r'\i', r"ı")
    return bib


@app.route('/bib')
def zotero_group():
    group_id = request.args.get('groupID')
    key = request.args.get('privateKey', default=None)
    escape = request.args.get('escape', default=False)
    print('Request', group_id, key)
    limit = 100
    start = limit
    base_url = 'https://api.zotero.org/groups/' + str(group_id) + \
               '/items/top?format=bibtex&style=numeric&limit=' + str(limit)
    if key:
        base_url += "&key=" + str(key)
    req = requests.get(base_url)
    req_text = req.text
    if req.ok is False:
        #     Error Handling
        return render_template('error.html', error_code=str(req.status_code), error_text=req_text)
    buffer = StringIO()
    buffer.write(req_text)
    # bib = req_text
    while req_text != '':
        request_url = base_url + "&start=" + str(start)
        print("Fetching ", request_url)
        req = requests.get(request_url)
        req_text = req.text
        buffer.write(req_text)
        start += limit

    if escape:
        string_val = buffer.getvalue()
        string_val = special_char_handle(string_val)
        buffer = StringIO()
        buffer.write(string_val)

    # Convert String Buffer to BytesIO so that send_file works
    mem = BytesIO()
    mem.write(buffer.getvalue().encode())
    mem.seek(0)
    buffer.close()
    return send_file(mem, as_attachment=True,
                     attachment_filename='references.bib', mimetype='text/plain')

    # show the post with the given id, the id is an integer
    # return 'Post %d' % post_id


# https://api.zotero.org/groups/2579480/items/top?format=bibtex&style=numeric&limit=1000
# run the app.
# run the app.
if __name__ == "__main__":
    # Setting debug to True enables debug output. This line should be
    # removed before deploying a production app.
    app.debug = True
    app.run()
